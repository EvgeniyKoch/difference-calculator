name: build
on:
    push:
        branches:
            - master
        tags:
            - '!*'
        paths:
            - src/*
            - _tests_/*
            - '*.json'
            - package-lock.json
    pull_request:
        paths:
            - '!*.MD'
jobs:
    test:
        strategy:
            matrix:
                platform: [ macOS-latest ]
                node: [ '12', '10' ]
        name: test/node ${{ matrix.node }}/${{ matrix.platform }}
        runs-on: ${{ matrix.platform }}
        steps:
            - uses: actions/checkout@master
            - uses: actions/setup-node@master
              with:
                  node-version: ${{ matrix.node }}
            - run: npm install -g npm
            - run: npm install
            - run: npm build
            - run: npm test
    coverage:
        needs: [ test ]
        name: coverage
        runs-on: macOS-latest
        steps:
            - uses: actions/checkout@master
            - uses: actions/setup-node@master
              with:
                  node-version: '12'
            - run: npm install -g npm
            - run: npm install
            - run: npm build
            - uses: paambaati/codeclimate-action@v2.2.4
              env:
                  CC_TEST_REPORTER_ID: ee12173e16131b52cab25c5ecbbe9087535b0efa3ba332e1cc5d867993f5ef2c
              with:
                  coverageCommand: npm run coverage
